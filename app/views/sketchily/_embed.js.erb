<% # This partial requires svgutils.js
   #
   # Clients of this partial must supply the following variables:
   # id
   # value
   # show_menu %>

var svgCanvas_<%= id %> = null;

function handleSvgData_<%= id %>(data, error) {
  if (error) {
    alert('Error: ' + error);
  }
  else {
    $("input#<%= id %>").attr("value", svgedit.utilities.encode64("<?xml version=\"1.0\"?>\n" + data));
    $("input#<%= id %>").closest("form").submit();
  }
}

function initEmbed_<%= id %>() {
  var frame = document.getElementById('svgedit_<%= id %>');
  svgCanvas_<%= id %> = new embedded_svg_edit(frame);

  <% unless show_menu %>
    // Hide main button, as we will be controlling new/load/save etc from the host document
    var doc;
    doc = frame.contentDocument;
    if (!doc) {
      doc = frame.contentWindow.document;
    }

    var mainButton = doc.getElementById('main_button');
    mainButton.style.display = 'none';            
  <% end %>
  
  $("input#<%= id %>").closest("form").one("submit", function(event) {
    svgCanvas_<%= id %>.getSvgString()(handleSvgData_<%= id %>);
    event.preventDefault();
  });

  svgCanvas_<%= id %>.setSvgString(svgedit.utilities.decode64("<%= value.try(:squish) %>"));
}
